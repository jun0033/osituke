<div class="container">
  <%= flash[:notice] %>
  <div class="row">
    <div class="col-8 px-5 mx-auto my-3" style="background-color: #d4ecea;">
      <%= form_with model: @user, url: admin_user_path, metod: :patch, local: true do |f| %>
      <div class="form-group">
        <h4>ユーザーアイコン</h4>
        <!--imageをクリックで発火するようにラベルで包む-->
        <%= f.label :profile_image do %>
        <%= image_tag @user.get_profile_image(130,130), id: "preview" %>
        <%= f.file_field :profile_image, accept: "image/*", style: 'display:none;' %>
        <% end %>
      </div>
      <div class="form-group">
        <h4>ユーザーネーム(2文字以上15文字以内)</h4>
        <%= f.text_field :name, placeholder: @user.name, class:"form-control" %>
      </div>
      <div class="form-group">
        <h4>紹介文(100文字以内)</h4>
        <%= f.text_area :introduction, placeholder: @user.introduction, class:"form-control" %>
      </div>
      <div class="form-group">
        <h4>メールアドレス</h4>
        <%= f.email_field :email, placeholder: @user.email, class:"form-control" %>
      </div>
      <div class="form-group">
        <%= f.submit '更新する', class:"btn btn-secondary" %>
      </div>
      <% end %>
    </div>
  </div>
</div>

<script>
  // アイコンに変更があったら即実行
  $('#user_profile_image').on('change', function (e) {
    var reader = new FileReader();
    reader.onload = function (e) {
    // imgタグであるidがpreviewになっている場所を探し、画像表示のためのsrcを書き換える
      $("#preview").attr('src', e.target.result);
    }
    reader.readAsDataURL(e.target.files[0]);
});
</script>