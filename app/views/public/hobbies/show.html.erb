<div class="container text-center wrap">
  <%= flash[:notice] %>
  <div class="row my-3 mx-5 p-1" style="background-color: #d4ecea;">
    <div class="col-2 text-right mt-1">
      <%= image_tag @user.get_profile_image(80,80) %>
    </div>
    <div class="col-2 col-sm-2 text-left">
     <h4><%= link_to @user.name, user_path(@user.id) %></h4>
    </div>
    <div class="col-8 col-sm-8 text-left p-2">
      <div class="row">
        <h5 class="col-5"><%= @hobby.title %></h5>
        <div class="col-5 d-flex">
          <div id="star-rate<%= @hobby.id %>"></div>
          (<%= @hobby.hobby_comments.average(:star).to_f.round(1) %>)
        </div>
        <div class="col-2 text-right">
          <%= link_to tag_path(@hobby.tag.id), class: "btn btn-outline-info rounded-pill" do %>
          <i class="fas fa-tag"></i>
          <%= @hobby.tag.tag_name %>
          <% end %>
        </div>
      </div>
      <div class="row" style="width: 100%;">
        <!--ユーザーのつけた段落を反映-->
        <%= safe_join(@hobby.body.split("\n"),tag(:br)) %>
      </div>
      <div class="row">
        <% @hobby.hobby_images.each do |hobby_image| %>
        <%= image_tag(hobby_image, width:100, height:100 )%>
        <% end %>
      </div>
      <div class="row mt-1">
        <div class="col-4" id="favorite_buttons_<%= @hobby.id %>">
          <%= render "public/favorites/favorite", hobby: @hobby %>
        </div>
        <div class="col-4" id="todo_buttons_<%= @hobby.id %>">
        <%= render "public/to_does/to_do", hobby: @hobby %>
        </div>
        <% if @hobby.user.id == current_user.id %>
        <div class="col-1">
          <%= link_to edit_hobby_path(@hobby.id), style: "right: 5px;" do %>
          <i class="fas fa-cogs"></i>
          <% end %>
        </div>
        <div class="col-1">
          <%= link_to hobby_path(@hobby.id), method: :delete, style: "right: 5px;", data: { confirm: "【確認】趣味を削除してもよろしいですか？" } do %>
          <i class="fas fa-trash fa-lg"></i>
          <% end %>
        </div>
        <% end %>
      </div>
    </div>
  </div>
  <%= @hobby.hobby_comments.count %> コメント
  <%= render "public/hobby_comments/comments_index", comments: @comments %>
</div>
<%= render "public/hobby_comments/comment_form", comment: @comment,hobby: @hobby %>
<script>
$(document).on('turbolinks:load', function() {
  let elem = document.querySelector('#star-rate<%= @hobby.id %>');
  if (elem == null) return;

  elem.innerHTML = "";
  let opt = {
    starOn: "<%= asset_path('star-on.png') %>",
    starOff: "<%= asset_path('star-off.png') %>",
    starHalf: "<%= asset_path('star-half.png') %>",
    score: "<%= @hobby.hobby_comments.average(:star).to_f.round(1) %>",
    readOnly: true,
    half: true
  };
  raty(elem, opt);
});
</script>